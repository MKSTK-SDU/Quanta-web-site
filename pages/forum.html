<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Forum - Quanta Physics Education Platform</title>
    <meta name="description" content="Join discussions on physics topics with LaTeX support for equations and formulas. Get your physics questions answered by peers and experts.">
    <link rel="stylesheet" href="../assets/css/styles.css">
    <style>
        /* Forum-specific styles */
        .forum-header {
            background-color: var(--secondary-color);
            padding: var(--spacing-xl) 0;
            color: var(--white);
            text-align: center;
            margin-bottom: var(--spacing-lg);
        }
        
        .forum-title {
            font-size: var(--font-size-xl);
            margin-bottom: var(--spacing-md);
        }
        
        .forum-description {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .forum-sidebar {
            flex: 1;
            min-width: 250px;
        }
        
        .forum-main {
            flex: 3;
        }
        
        .forum-filters {
            background-color: var(--white);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--spacing-xl);
        }
        
        .search-bar {
            margin-bottom: var(--spacing-lg);
        }
        
        .search-input {
            width: 100%;
            padding: var(--spacing-md);
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius-sm);
            font-size: var(--font-size-normal);
        }
        
        .filter-row {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        
        .discussion-list {
            margin-bottom: var(--spacing-xl);
        }
        
        .discussion-item {
            background-color: var(--white);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-lg);
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }
        
        .discussion-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .discussion-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-md);
        }
        
        .discussion-info {
            flex: 1;
        }
        
        .discussion-title {
            font-size: var(--font-size-large);
            margin-bottom: var(--spacing-sm);
        }
        
        .discussion-meta {
            color: var(--gray-600);
            font-size: var(--font-size-small);
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }
        
        .discussion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-sm);
        }
        
        .discussion-tag {
            background-color: var(--primary-light);
            color: var(--primary-dark);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: 20px;
            font-size: var(--font-size-small);
        }
        
        .discussion-votes {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 50px;
        }
        
        .vote-btn {
            background: none;
            border: none;
            color: var(--gray-600);
            cursor: pointer;
            font-size: var(--font-size-large);
            transition: color var(--transition-fast);
        }
        
        .vote-btn:hover {
            color: var(--primary-color);
        }
        
        .vote-count {
            font-weight: bold;
            margin: var(--spacing-xs) 0;
        }
        
        .discussion-preview {
            margin-bottom: var(--spacing-md);
            color: var(--text-color);
        }
        
        .discussion-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .discussion-action-link {
            color: var(--primary-color);
            font-size: var(--font-size-small);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
        }
        
        .discussion-action-link:hover {
            text-decoration: underline;
        }
        
        .create-discussion-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: var(--shadow-lg);
            z-index: 10;
            cursor: pointer;
            transition: transform var(--transition-fast), background-color var(--transition-fast);
        }
        
        .create-discussion-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
        }
        
        .create-discussion-form {
            background-color: var(--white);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-md);
            margin-top: var(--spacing-xl);
            display: none;
        }
        
        .tag-selector {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
        }
        
        .tag-option {
            background-color: var(--gray-200);
            color: var(--gray-700);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: 20px;
            font-size: var(--font-size-small);
            cursor: pointer;
            transition: background-color var(--transition-fast), color var(--transition-fast);
        }
        
        .tag-option.selected {
            background-color: var(--primary-light);
            color: var(--primary-dark);
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: var(--spacing-xl);
        }
        
        .pagination-item {
            margin: 0 var(--spacing-xs);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--gray-300);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .pagination-item:hover {
            background-color: var(--gray-100);
        }
        
        .pagination-item.active {
            background-color: var(--primary-color);
            color: var(--white);
            border-color: var(--primary-color);
        }
        
        .latex-preview {
            background-color: var(--gray-100);
            padding: var(--spacing-md);
            border-radius: var(--border-radius-sm);
            margin-top: var(--spacing-md);
            border: 1px solid var(--gray-300);
        }
        
        .latex-help {
            margin-top: var(--spacing-xs);
            font-size: var(--font-size-small);
            color: var(--gray-600);
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="container">
            <a href="../index.html" class="logo">Quanta</a>
            <nav class="main-nav">
                <ul>
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="library.html">Library</a></li>
                    <li><a href="forum.html" class="active">Forum</a></li>
                    <li><a href="exam-prep.html">Exams</a></li>
                    <li><a href="profile.html">Profile</a></li>
                </ul>
            </nav>
            <div class="user-controls">
                <a href="login.html" class="btn btn-primary">Login</a>
                
                <button id="mobile-menu-btn" class="mobile-menu-btn">☰</button>
            </div>
        </div>
    </header>

    <div id="mobile-menu" class="mobile-menu">
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="library.html">Library</a></li>
            <li><a href="forum.html" class="active">Forum</a></li>
            <li><a href="exam-prep.html">Exams</a></li>
            <li><a href="profile.html">Profile</a></li>
            <li><a href="login.html">Login</a></li>
        </ul>
    </div>
    
    <section class="forum-header">
        <div class="container">
            <h1 class="forum-title">Physics Discussion Forum</h1>
            <p class="forum-description">Join the conversation with fellow physics enthusiasts. Ask questions, share insights, and deepen your understanding with our LaTeX-supported discussion platform.</p>
        </div>
    </section>
    
    <main class="container">
        <div class="forum-filters">
            <div class="search-bar">
                <input type="text" id="search-input" class="search-input" placeholder="Search discussions...">
            </div>
            
            <div class="filter-row">
                <div class="filter-group" style="flex: 2;">
                    <label for="tag-filter" class="filter-label">Topic</label>
                    <select id="tag-filter" class="filter-select">
                        <option value="all">All Topics</option>
                        <option value="mechanics">Mechanics</option>
                        <option value="quantum">Quantum Physics</option>
                        <option value="electromagnetism">Electromagnetism</option>
                        <option value="thermodynamics">Thermodynamics</option>
                        <option value="relativity">Relativity</option>
                        <option value="wave-mechanics">Wave Mechanics</option>
                        <option value="angular-momentum">Angular Momentum</option>
                        <option value="problem-solving">Problem Solving</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="solved-filter" class="filter-label">Status</label>
                    <select id="solved-filter" class="filter-select">
                        <option value="all">All Statuses</option>
                        <option value="true">Solved</option>
                        <option value="false">Unsolved</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="sort-filter" class="filter-label">Sort By</label>
                    <select id="sort-filter" class="filter-select">
                        <option value="recent">Most Recent</option>
                        <option value="popular">Most Popular</option>
                        <option value="views">Most Viewed</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="flex gap-lg" style="flex-wrap: wrap;">
            <div class="forum-main">
                <div id="discussion-list" class="discussion-list">
                    <!-- Discussions will be populated dynamically via JavaScript -->
                </div>
                
                <div class="pagination">
                    <div class="pagination-item" data-page="prev">❮</div>
                    <div class="pagination-item active" data-page="1">1</div>
                    <div class="pagination-item" data-page="2">2</div>
                    <div class="pagination-item" data-page="next">❯</div>
                </div>
            </div>
            
            <div class="forum-sidebar">
                <div class="card mb-lg" style="padding: var(--spacing-lg);">
                    <h3 class="mb-md">Popular Tags</h3>
                    <div class="discussion-tags">
                        <span class="discussion-tag">quantum</span>
                        <span class="discussion-tag">mechanics</span>
                        <span class="discussion-tag">relativity</span>
                        <span class="discussion-tag">electromagnetism</span>
                        <span class="discussion-tag">thermodynamics</span>
                        <span class="discussion-tag">problem-solving</span>
                        <span class="discussion-tag">wave-mechanics</span>
                        <span class="discussion-tag">angular-momentum</span>
                    </div>
                </div>
                
                <div class="card" style="padding: var(--spacing-lg);">
                    <h3 class="mb-md">Forum Guidelines</h3>
                    <ul style="list-style-type: disc; padding-left: var(--spacing-lg);">
                        <li>Be respectful and constructive in discussions</li>
                        <li>Use LaTeX for equations ($...$ for inline, $$...$$  for block)</li>
                        <li>Include relevant context with your questions</li>
                        <li>Tag discussions appropriately for better visibility</li>
                        <li>Mark your question as solved when resolved</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div id="create-discussion-form" class="create-discussion-form">
            <h2 class="mb-lg">Start a New Discussion</h2>
            <form id="discussion-form">
                <div class="form-group">
                    <label for="title" class="form-label">Title</label>
                    <input type="text" id="title" name="title" class="form-control" required placeholder="Ask a question or start a discussion...">
                </div>
                
                <div class="form-group">
                    <label for="content" class="form-label">Content (supports LaTeX: $...$)</label>
                    <textarea id="content" name="content" class="form-control" rows="10" required placeholder="Describe your question or topic in detail..."></textarea>
                    <div class="latex-help">Use $E = mc^2$ for inline equations and $$F = ma$$ for block equations</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Tags (select at least one)</label>
                    <div class="tag-selector" id="tag-selector">
                        <span class="tag-option" data-tag="mechanics">Mechanics</span>
                        <span class="tag-option" data-tag="quantum">Quantum Physics</span>
                        <span class="tag-option" data-tag="electromagnetism">Electromagnetism</span>
                        <span class="tag-option" data-tag="thermodynamics">Thermodynamics</span>
                        <span class="tag-option" data-tag="relativity">Relativity</span>
                        <span class="tag-option" data-tag="wave-mechanics">Wave Mechanics</span>
                        <span class="tag-option" data-tag="angular-momentum">Angular Momentum</span>
                        <span class="tag-option" data-tag="problem-solving">Problem Solving</span>
                    </div>
                    <input type="hidden" id="selected-tags" name="tags">
                </div>
                
                <div class="form-group">
                    <button type="button" id="preview-btn" class="btn btn-outline">Preview</button>
                </div>
                
                <div id="latex-preview" class="latex-preview" style="display: none;">
                    <h3 class="mb-sm">Preview</h3>
                    <div id="preview-content"></div>
                </div>
                
                <div class="flex justify-between mt-lg">
                    <button type="button" id="cancel-discussion-btn" class="btn btn-outline">Cancel</button>
                    <button type="submit" class="btn btn-primary">Post Discussion</button>
                </div>
            </form>
        </div>
        
        <button id="create-discussion-btn" class="create-discussion-btn">+</button>
    </main>
    
    <footer class="main-footer">
        <div class="container">
            
            <div class="footer-copyright">
                <p>&copy; 2024 Quanta Physics Education Platform. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="../assets/js/data.js"></script>
    <script src="../assets/js/utils.js"></script>
    <script src="../assets/js/main.js"></script>
    <script>
        // Page state
        let currentPage = 1;
        const itemsPerPage = 5;
        let filteredDiscussions = [...discussionsData];
        let selectedTags = [];
        
        // DOM Elements
        const discussionList = document.getElementById('discussion-list');
        const createDiscussionBtn = document.getElementById('create-discussion-btn');
        const createDiscussionForm = document.getElementById('create-discussion-form');
        const discussionForm = document.getElementById('discussion-form');
        const cancelDiscussionBtn = document.getElementById('cancel-discussion-btn');
        const previewBtn = document.getElementById('preview-btn');
        const latexPreview = document.getElementById('latex-preview');
        const previewContent = document.getElementById('preview-content');
        const tagSelector = document.getElementById('tag-selector');
        const selectedTagsInput = document.getElementById('selected-tags');
        
        // Search and filter elements
        const searchInput = document.getElementById('search-input');
        const tagFilter = document.getElementById('tag-filter');
        const solvedFilter = document.getElementById('solved-filter');
        const sortFilter = document.getElementById('sort-filter');
        
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize page
            applyFiltersAndRender();
            setupEventListeners();
        });
        
        function setupEventListeners() {
            // Search input
            searchInput.addEventListener('input', debounce(function() {
                currentPage = 1;
                applyFiltersAndRender();
            }, 300));
            
            // Filter selects
            tagFilter.addEventListener('change', function() {
                currentPage = 1;
                applyFiltersAndRender();
            });
            
            solvedFilter.addEventListener('change', function() {
                currentPage = 1;
                applyFiltersAndRender();
            });
            
            sortFilter.addEventListener('change', function() {
                applyFiltersAndRender();
            });
            
            // Pagination
            document.querySelectorAll('.pagination-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.dataset.page;
                    
                    if (page === 'prev') {
                        if (currentPage > 1) currentPage--;
                    } else if (page === 'next') {
                        const totalPages = Math.ceil(filteredDiscussions.length / itemsPerPage);
                        if (currentPage < totalPages) currentPage++;
                    } else {
                        currentPage = parseInt(page);
                    }
                    
                    updatePagination();
                    renderDiscussions();
                });
            });
            
            // Create discussion button
            createDiscussionBtn.addEventListener('click', function() {
                if (!currentUser) {
                    alert('Please log in to start a discussion.');
                    window.location.href = 'login.html';
                    return;
                }
                
                createDiscussionForm.style.display = 'block';
                window.scrollTo({ top: createDiscussionForm.offsetTop - 100, behavior: 'smooth' });
            });
            
            // Cancel discussion button
            cancelDiscussionBtn.addEventListener('click', function() {
                createDiscussionForm.style.display = 'none';
                discussionForm.reset();
                selectedTags = [];
                updateSelectedTags();
                latexPreview.style.display = 'none';
            });
            
            // Preview button
            previewBtn.addEventListener('click', function() {
                const content = document.getElementById('content').value;
                previewContent.innerHTML = renderLatex(content);
                latexPreview.style.display = 'block';
            });
            
            // Tag selector
            tagSelector.querySelectorAll('.tag-option').forEach(tag => {
                tag.addEventListener('click', function() {
                    const tagValue = this.dataset.tag;
                    
                    if (selectedTags.includes(tagValue)) {
                        // Remove tag
                        selectedTags = selectedTags.filter(tag => tag !== tagValue);
                        this.classList.remove('selected');
                    } else {
                        // Add tag
                        selectedTags.push(tagValue);
                        this.classList.add('selected');
                    }
                    
                    updateSelectedTags();
                });
            });
            
            // Discussion form
            discussionForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!currentUser) {
                    alert('Please log in to post a discussion.');
                    window.location.href = 'login.html';
                    return;
                }
                
                // Get form values
                const title = document.getElementById('title').value;
                const content = document.getElementById('content').value;
                
                // Validate
                if (selectedTags.length === 0) {
                    alert('Please select at least one tag.');
                    return;
                }
                
                // Create new discussion
                const newDiscussion = {
                    id: discussionsData.length + 1,
                    title,
                    content,
                    tags: selectedTags,
                    upvotes: 0,
                    downvotes: 0,
                    views: 0,
                    isSolved: false,
                    createdAt: new Date().toISOString().split('T')[0],
                    user: {
                        username: currentUser.username,
                        isExpert: currentUser.isExpert
                    }
                };
                
                // Add to discussions array
                discussionsData.unshift(newDiscussion);
                
                // Reset form and hide container
                discussionForm.reset();
                selectedTags = [];
                updateSelectedTags();
                createDiscussionForm.style.display = 'none';
                latexPreview.style.display = 'none';
                
                // Rerender discussions
                applyFiltersAndRender();
                
                // Show success message
                alert('Discussion posted successfully!');
            });
        }
        
        function updateSelectedTags() {
            selectedTagsInput.value = selectedTags.join(',');
        }
        
        function applyFiltersAndRender() {
            const searchTerm = searchInput.value.toLowerCase();
            const tag = tagFilter.value;
            const solved = solvedFilter.value;
            const sortBy = sortFilter.value;
            
            // Filter discussions
            filteredDiscussions = discussionsData.filter(discussion => {
                // Search term filter
                const matchesSearch = 
                    !searchTerm || 
                    discussion.title.toLowerCase().includes(searchTerm) ||
                    (discussion.content && discussion.content.toLowerCase().includes(searchTerm));
                
                // Tag filter
                const matchesTag = tag === 'all' || discussion.tags.includes(tag);
                
                // Solved filter
                const matchesSolved = 
                    solved === 'all' || 
                    (solved === 'true' && discussion.isSolved) || 
                    (solved === 'false' && !discussion.isSolved);
                
                return matchesSearch && matchesTag && matchesSolved;
            });
            
            // Sort discussions
            filteredDiscussions.sort((a, b) => {
                switch (sortBy) {
                    case 'recent':
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'popular':
                        return (b.upvotes - b.downvotes) - (a.upvotes - a.downvotes);
                    case 'views':
                        return b.views - a.views;
                    default:
                        return 0;
                }
            });
            
            updatePagination();
            renderDiscussions();
        }
        
        function renderDiscussions() {
            // Calculate pagination
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedDiscussions = filteredDiscussions.slice(startIndex, endIndex);
            
            discussionList.innerHTML = '';
            
            if (filteredDiscussions.length === 0) {
                discussionList.innerHTML = '<div class="no-results">No discussions found matching your criteria.</div>';
                return;
            }
            
            paginatedDiscussions.forEach(discussion => {
                const discussionElement = document.createElement('div');
                discussionElement.className = 'discussion-item';
                
                // Create tags HTML
                let tagsHTML = '';
                discussion.tags.forEach(tag => {
                    tagsHTML += `<span class="discussion-tag">${tag}</span>`;
                });
                
                discussionElement.innerHTML = `
                    <div class="discussion-header">
                        <div class="discussion-info">
                            <h2 class="discussion-title">${discussion.title}</h2>
                            <div class="discussion-tags">
                                ${tagsHTML}
                                ${discussion.isSolved ? 
                                  '<span class="discussion-tag" style="background-color: var(--success-light); color: var(--success-color);">Solved</span>' : 
                                  ''}
                                ${discussion.user.isExpert ? 
                                  '<span class="discussion-tag" style="background-color: var(--primary-light); color: var(--primary-dark);">Expert</span>' : 
                                  ''}
                            </div>
                            <div class="discussion-meta">
                                <span>By ${discussion.user.username}</span>
                                <span>👁️ ${discussion.views} views</span>
                                <span>Posted ${formatDate(discussion.createdAt)}</span>
                            </div>
                        </div>
                        <div class="discussion-votes">
                            <button class="vote-btn vote-up">▲</button>
                            <span class="vote-count">${discussion.upvotes - discussion.downvotes}</span>
                            <button class="vote-btn vote-down">▼</button>
                        </div>
                    </div>
                    <div class="discussion-preview">${renderLatex(truncateText(discussion.content, 300))}</div>
                    <div class="discussion-actions">
                        <a href="#" class="discussion-action-link">Read more</a>
                        <div class="discussion-action-stats">
                            <span>${Math.floor(Math.random() * 10) + 1} replies</span>
                        </div>
                    </div>
                `;
                
                // Add event listeners for vote buttons
                const upvoteBtn = discussionElement.querySelector('.vote-up');
                const downvoteBtn = discussionElement.querySelector('.vote-down');
                
                upvoteBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    handleVote(discussion.id, 'up');
                });
                
                downvoteBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    handleVote(discussion.id, 'down');
                });
                
                discussionList.appendChild(discussionElement);
            });
        }
        
        function handleVote(discussionId, direction) {
            if (!currentUser) {
                alert('Please log in to vote on discussions.');
                return;
            }
            
            const discussion = discussionsData.find(d => d.id === discussionId);
            if (!discussion) return;
            
            if (direction === 'up') {
                discussion.upvotes += 1;
            } else {
                discussion.downvotes += 1;
            }
            
            // Rerender discussions to update vote count
            renderDiscussions();
        }
        
        function updatePagination() {
            const totalPages = Math.ceil(filteredDiscussions.length / itemsPerPage);
            
            // Update pagination numbers
            const paginationItems = document.querySelectorAll('.pagination-item');
            
            // Show/hide pagination based on results
            const pagination = document.querySelector('.pagination');
            pagination.style.display = totalPages <= 1 ? 'none' : 'flex';
            
            if (totalPages <= 3) {
                // If 3 pages or less, show exact pages
                for (let i = 0; i < 3; i++) {
                    const pageItem = paginationItems[i + 1]; // Skip prev button
                    if (i < totalPages) {
                        pageItem.textContent = i + 1;
                        pageItem.style.display = 'flex';
                    } else {
                        pageItem.style.display = 'none';
                    }
                }
            } else {
                // If more than 3 pages, show adaptive pagination
                if (currentPage === 1) {
                    paginationItems[1].textContent = '1';
                    paginationItems[2].textContent = '2';
                    paginationItems[3].textContent = '3';
                } else if (currentPage === totalPages) {
                    paginationItems[1].textContent = totalPages - 2;
                    paginationItems[2].textContent = totalPages - 1;
                    paginationItems[3].textContent = totalPages;
                } else {
                    paginationItems[1].textContent = currentPage - 1;
                    paginationItems[2].textContent = currentPage;
                    paginationItems[3].textContent = currentPage + 1;
                }
            }
            
            // Update active state
            paginationItems.forEach(item => {
                if (item.dataset.page !== 'prev' && item.dataset.page !== 'next') {
                    item.classList.toggle('active', parseInt(item.textContent) === currentPage);
                }
            });
        }
    </script>
</body>
</html>